<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‚ö° Smart Energy System</title>
  <style>
    body { font-family:'Segoe UI',sans-serif; background:#f4f6f8; margin:0; padding:20px; }
    .container { max-width:1000px; margin:auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
    h1,h2 { text-align:center; color:#2c3e50; }
    nav { text-align:center; margin-bottom:20px; }
    nav button { margin:5px; padding:10px 15px; background:#3498db; color:#fff; border:none; border-radius:5px; cursor:pointer; }
    nav button:hover { background:#2980b9; }
    .page { display:none; } .active { display:block; }
    img,canvas { width:100%; margin-top:20px; border:1px solid #ccc; border-radius:5px; }
    label { font-weight:bold; display:block; margin-top:15px; }
    select,input[type="number"] { width:100%; padding:10px; margin-top:5px; border-radius:5px; border:1px solid #ccc; }
    .predict { margin-top:20px; padding:12px 20px; background:#3498db; color:#fff; border:none; border-radius:5px; cursor:pointer; font-size:16px; }
    .predict:hover { background:#2980b9; }
    .result,.tip { margin-top:30px; padding:15px; background:#ecf0f1; border-left:5px solid #3498db; border-radius:5px; }
    #loading { display:none; margin-top:20px; text-align:center; color:#555; font-style:italic; }
    #history { margin-top:40px; padding:15px; background:#fdfdfd; border-left:5px solid #2c3e50; border-radius:5px; }
    #history h3 { margin-bottom:10px; color:#2c3e50; }
    #history ul { list-style-type:disc; padding-left:20px; }
  </style>
</head>
<body>
<div class="container">
  <h1>‚ö° Smart Energy System</h1>
  <nav>
    <button onclick="showPage('dashboardPage')">üìä Dashboard</button>
    <button onclick="showPage('forecastPage')">üîÆ Forecast Prediction</button>
  </nav>

  <!-- Dashboard -->
  <div id="dashboardPage" class="page active">
    <h2>Dashboard components for hourly/daily/weekly/monthly consumption</h2>
    <img src="/plot/overview" alt="Overview"/>
    <h3>Device-wise Energy Consumption</h3>
    <img src="/plot/devices" alt="Devices"/>
  </div>

  <!-- Forecast -->
  <div id="forecastPage" class="page">
    <h2>‚ö° Smart Energy Forecast</h2>
    <label for="currentEnergy">Current Energy Usage (kWh):</label>
    <input type="number" id="currentEnergy" placeholder="Enter current usage e.g. 42" step="0.01"/>
    <label for="device">Select Device:</label>
    <select id="device">
      <option value="Fridge">ü•∂ Fridge</option>
      <option value="Air Conditioner">‚ùÑÔ∏è Air Conditioner</option>
      <option value="Dishwasher">üçΩÔ∏è Dishwasher</option>
      <option value="Laundry">üëï Laundry</option>
      <option value="Microwave">üç≤ Microwave</option>
    </select>
    <label for="time">Select Time Feature:</label>
    <select id="time">
      <option value="hourly">Hourly</option>
      <option value="daily">Daily</option>
      <option value="weekly">Weekly</option>
      <option value="monthly">Monthly</option>
    </select>
    <button class="predict" onclick="getPrediction()">Predict</button>
    <div id="loading">‚è≥ Loading prediction...</div>
    <div class="result" id="forecastResult">Prediction will appear here...</div>
    <div class="tip" id="smartTip">Smart energy tip will appear here...</div>
    <canvas id="forecastChart"></canvas>
    <div id="history">
      <h3>üìú Prediction History</h3>
      <ul id="historyList"></ul>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// Forecast Prediction
async function getPrediction(){
  const currentEnergy=document.getElementById("currentEnergy").value;
  const device=document.getElementById("device").value;
  const time=document.getElementById("time").value;

  if(!currentEnergy){ 
    alert("Please enter current energy usage."); 
    return; 
  }

  document.getElementById("loading").style.display="block";
  document.getElementById("forecastResult").innerText="";
  document.getElementById("smartTip").innerText="";

  try{
    const response=await fetch("/predict",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({
        current_energy:parseFloat(currentEnergy),
        device:device,
        time_feature:time
      })
    });
    if(!response.ok) throw new Error("Server error");
    const data=await response.json();

    document.getElementById("forecastResult").innerText=`üîÆ Predicted ${time} usage for ${device}: ${data.prediction_kWh} kWh`;
    document.getElementById("smartTip").innerText=`üí° Energy Tip: ${data.smart_tip||"No tip available."}`;
    renderChart(data.trend||[]);

    const historyList=document.getElementById("historyList");
    const li=document.createElement("li");
    li.textContent=`${new Date().toLocaleString()} ‚Äî ${device} (${time}): ${data.prediction_kWh} kWh`;
    historyList.prepend(li);
  }catch(err){
    document.getElementById("forecastResult").innerText="‚ö†Ô∏è Prediction failed. Please try again.";
  }finally{
    document.getElementById("loading").style.display="none";
  }
}

function renderChart(trendData){
  const ctx=document.getElementById("forecastChart").getContext("2d");
  if(window.energyChart) window.energyChart.destroy();
  const labels=trendData.map(item=>item.time);
  const values=trendData.map(item=>item.value);
  window.energyChart=new Chart(ctx,{
    type:"line",
    data:{labels:labels,datasets:[{label:"Energy Usage (kWh)",data:values,borderColor:"#3498db",backgroundColor:"rgba(52,152,219,0.2)",fill:true,tension:0.3}]},
    options:{responsive:true,plugins:{tooltip:{enabled:true},legend:{display:true}},scales:{x:{title:{display:true,text:"Time"}},y:{title:{display:true,text:"kWh"},beginAtZero:true}}}
  });
}
</script>
</body>
</html>
