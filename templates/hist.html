<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>History</title>
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.jpg') }}" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
</head>

<body>
  <a href="/forecast" class="btn btn-secondary mt-1 mb-5" tabindex="-1" role="button">Go to Forecast Page</a>
  <h2>Historical Analysis</h2>
  <form class="formContainer" action="/history-dashboard" method="post">
    <select name="history_range" class="form-select mb-5 home-select">
      <option disabled selected>Select Day Range</option>
      <option value="day_range">Past Day</option>
      <option value="week_range">Past Week</option>
      <option value="month_range">Past Month</option>
    </select>
    <button type="submit" class="btn btn-outline-light mt-5">Submit</button>
  </form>
  <hr>

  {% if dashboard %}
  <!-- chart containers -->
  <div class="dashboard-top d-flex gap-3" style="width: 90%; flex-wrap: wrap;">
    <div class="d-flex gap-3 flex-wrap flex-fill" style="width: 25%;">
      <div id="kpiCards" class="device-type d-flex flex-wrap gap-2"></div>
    </div>
    <div id="pieChart" style="flex: 1 1 300px; min-width: 350px; max-width: 600px; height: 350px;"></div>
  </div>
  <div class="chart-space">
    <div id="lineChartDaily" style="height:400px; width: 100%;"></div>
    {% if dashboard.metadata.range == "month_range" %}
    <div id="weeklyChart" style="height:400px; width: 100%;"></div>
    {% endif %}
  </div>
  <div class="dashboard-footer" style="height:400px; width: 100%;">
    <div id="top-devices"></div>
  </div>
  <!-- embed dashboard JSON in a data attribute -->
  <div id="dashboardContainer" class="mb-5" data-dashboard='{{ dashboard | tojson | safe }}'></div>
  {% else %}
  <h3>No Analysis yet</h3>
  {% endif %}
  <hr>
  <h5>Get reports</h5>
  <form action="/history-reports" method="post" class="forecast-form">
    <section class="forecast-input">
      <div class="container">
        <label for="device_type[]">Device Type:</label>
        <div class="device-type d-flex flex-wrap gap-2">
          <input type="checkbox" class="btn-check" id="fridge" name="device_type[]" value="fridge">
          <label class="btn btn-outline-dark checks" for="fridge">Fridge</label>

          <input type="checkbox" class="btn-check" id="ac" name="device_type[]" value="air_conditioner">
          <label class="btn btn-outline-dark checks" for="ac">AC</label>

          <input type="checkbox" class="btn-check" id="washer" name="device_type[]" value="washer">
          <label class="btn btn-outline-dark checks" for="washer">Washer</label>

          <input type="checkbox" class="btn-check" id="tv" name="device_type[]" value="tv">
          <label class="btn btn-outline-dark checks" for="tv">TV</label>

          <input type="checkbox" class="btn-check" id="light" name="device_type[]" value="light">
          <label class="btn btn-outline-dark checks" for="light">Lights</label>
        </div>
      </div>
      <div class="container">
        <label for="history_range">for past:</label>
        <select name="history_range" class="form-select forecast-select">
          <option disabled selected>Select Day Range</option>
          <option value="day_range">Day</option>
          <option value="week_range">Week</option>
          <option value="month_range">Month</option>
        </select>
      </div>
    </section>
    <div class="btn-group mb-3 mt-1" role="group" aria-label="Basic mixed styles example">
      <button type="submit" name="report_type" value="pdf"class="btn btn-danger">Get PDF</button>
      <button type="submit" name="report_type" value="csv" class="btn btn-success">GET CSV</button>
    </div>
  </form>

  <script>
    document.querySelector('.forecast-form').addEventListener('submit', function (e) {
      const checked = document.querySelectorAll('input[name="device_type[]"]:checked');
      if (checked.length === 0) {
        e.preventDefault();
        alert("Pick at least ONE device.");
      }
    });
  </script>

  <!-- load Plotly -->
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
  <!-- chart JS -->
  <script src="{{ url_for('static', filename='js/hist_charts.js') }}"></script>

  <!-- bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
    crossorigin="anonymous"></script>
</body>

</html>